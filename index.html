<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Tetris: Articles A2</title>
    <style>
        body {
            background-color: #001f3f; 
            background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh; /* Fixed height to fit screen */
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
        }

        #game-container {
            display: flex;
            gap: 20px;
            position: relative;
            align-items: flex-start;
            transform: scale(1); /* Base scale */
        }

        canvas {
            border: 4px solid #fff;
            background-color: #000;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.3);
            border-radius: 4px;
            display: block;
        }

        #sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 180px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h2 { 
            margin: 0 0 5px 0; 
            font-size: 1rem; 
            color: #ffd700; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
        }

        p { margin: 0; font-size: 1rem; font-weight: bold; }

        .star { color: #ffd700; font-size: 1.2rem; margin-bottom: 5px; }
        
        /* Controls - Smaller for Laptop */
        #controls-area {
            margin-top: 15px;
            display: grid;
            grid-template-columns: 50px 50px 50px;
            grid-template-rows: 50px 50px;
            gap: 10px;
            justify-content: center;
        }

        .ctrl-btn {
            background: linear-gradient(145deg, #3a3a4a, #1a1a25);
            border: 2px solid #555;
            color: white;
            font-size: 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: all 0.1s;
        }

        .ctrl-btn:active {
            transform: translateY(2px);
            background: #2a2a35;
            border-color: #ffd700;
        }

        .ctrl-btn.rotate { grid-column: 2; grid-row: 1; border-color: #ffd700; }
        .ctrl-btn.left { grid-column: 1; grid-row: 2; }
        .ctrl-btn.down { grid-column: 2; grid-row: 2; }
        .ctrl-btn.right { grid-column: 3; grid-row: 2; }

        button.menu-btn {
            background: linear-gradient(45deg, #ff0055, #ff5500);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: transform 0.1s;
            width: 100%;
            margin-bottom: 8px;
            box-shadow: 0 4px 10px rgba(255, 0, 85, 0.4);
        }
        button.menu-btn:hover { transform: scale(1.02); }
        button.menu-btn.secondary { background: linear-gradient(45deg, #0055ff, #00aaff); }

        /* Modal Styles */
        #modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        #modal-content {
            background: #1a1a2e;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            width: 90%;
            max-width: 450px;
            border: 2px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
        }

        #question-text { font-size: 1.2rem; margin-bottom: 20px; color: #fff; line-height: 1.4; }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .option-btn {
            background: linear-gradient(45deg, #444, #666);
            font-size: 1rem;
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .option-btn:hover { background: linear-gradient(45deg, #555, #888); }

        .feedback {
            margin-top: 15px;
            font-weight: bold;
            height: 25px;
            font-size: 1.1rem;
        }
        .correct { color: #00ff00; text-shadow: 0 0 10px #00ff00; }
        .wrong { color: #ff0000; text-shadow: 0 0 10px #ff0000; }

        /* Start Screen */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,31,63,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }

        .rules-box {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            max-width: 500px;
            text-align: left;
            line-height: 1.5;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 0.95rem;
        }

        .rules-box ul { padding-left: 20px; margin: 10px 0; }
        .rules-box li { margin-bottom: 5px; }

        .level-select {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        
        .mouse-hint {
            font-size: 0.85rem;
            color: #ccc;
            margin-top: 10px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #ffd700;
        }
        
        h1 { font-size: 2.5rem; margin-bottom: 15px; text-shadow: 2px 2px #ff0055; text-align: center; color: #fff; }
    </style>
</head>
<body>

    <!-- Start Screen -->
    <div id="start-screen">
        <h1>GRAMMAR TETRIS</h1>
        <div class="rules-box">
            <h3 style="color: #ffd700; margin-top: 0;">üìú Rules:</h3>
            <ul>
                <li>Collect lines of blocks to clear the board.</li>
                <li>When a line is cleared, the game pauses.</li>
                <li>Answer the grammar question (Level A2: Articles).</li>
                <li>Correct answer = 1 Star ‚≠ê.</li>
                <li>Collect 20 stars to win!</li>
            </ul>
            
            <div class="mouse-hint">
                <strong>üñ±Ô∏è Controls:</strong><br>
                Use the buttons below the game board.
            </div>
        </div>
        <div class="level-select">
            <button class="menu-btn" onclick="startGame('easy')">Easy</button>
            <button class="menu-btn" onclick="startGame('medium')">Medium</button>
            <button class="menu-btn" onclick="startGame('hard')">Hard</button>
        </div>
    </div>

    <!-- Game Over / Win Screen -->
    <div id="game-over-screen" style="display:none; position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,31,63,0.95); z-index:20; flex-direction:column; justify-content:center; align-items:center;">
        <h1 id="end-title" style="font-size: 3rem; color: #ffd700; text-shadow: 0 0 20px #ffd700; margin: 0;">GAME OVER</h1>
        <p id="end-score" style="font-size: 1.5rem; margin: 20px 0; color: #fff;">Stars: 0 / 20</p>
        <button class="menu-btn" onclick="location.reload()" style="width: 200px;">Try Again</button>
    </div>

    <div id="game-container">
        <div style="display: flex; flex-direction: column; align-items: center;">
            <!-- Canvas size: 12 cols * 25px = 300, 20 rows * 25px = 500 -->
            <canvas id="tetris" width="300" height="500"></canvas>
            
            <!-- Mouse Controls -->
            <div id="controls-area">
                <div class="ctrl-btn rotate" onclick="playerRotate(1)" title="Rotate">‚Üª</div>
                <div class="ctrl-btn left" onclick="playerMove(-1)" title="Left">‚Üê</div>
                <div class="ctrl-btn down" onclick="playerDrop()" title="Drop">‚Üì</div>
                <div class="ctrl-btn right" onclick="playerMove(1)" title="Right">‚Üí</div>
            </div>
        </div>
        
        <div id="sidebar">
            <div class="panel">
                <h2>Score</h2>
                <p id="score" style="color: #fff;">0</p>
            </div>
            <div class="panel">
                <h2>Stars</h2>
                <div id="stars-display" class="star">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
                <p id="stars-count" style="color: #aaa; font-size: 0.9rem;">0 / 20</p>
            </div>
            <div class="panel">
                <h2>Level</h2>
                <p id="level-display" style="color: #00aaff;">Easy</p>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="modal-overlay">
        <div id="modal-content">
            <h2 style="color:#fff; margin-bottom: 15px; font-size: 1.5rem;">GRAMMAR CHECK!</h2>
            <p id="question-text">Question goes here...</p>
            <div class="options-grid" id="options-container">
                <!-- Buttons injected via JS -->
            </div>
            <div id="feedback" class="feedback"></div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('tetris');
    const context = canvas.getContext('2d');
    const modal = document.getElementById('modal-overlay');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const feedback = document.getElementById('feedback');

    // Scale set to 25 for laptop fit (12*25=300px width, 20*25=500px height)
    context.scale(25, 25);

    // Game State
    let dropCounter = 0;
    let dropInterval = 1000;
    let lastTime = 0;
    let isPaused = false;
    let isGameOver = false;
    let stars = 0;
    let score = 0;
    let currentLevel = 'easy';
    let usedQuestions = new Set();

    // Bright Gradient Colors
    const colors = [
        null,
        '#FF0055', // T - Hot Pink
        '#00FFFF', // I - Cyan
        '#00FF55', // S - Neon Green
        '#AA00FF', // Z - Purple
        '#FFAA00', // L - Orange
        '#FFFF00', // O - Yellow
        '#0055FF', // J - Blue
    ];

    // Question Database (A2 Articles)
    const questions = [
        { q: "I saw ___ elephant at the zoo.", a: ["an", "a", "the", "-"], correct: 0 },
        { q: "She is ___ honest person.", a: ["a", "an", "the", "-"], correct: 1 },
        { q: "Can you pass me ___ salt, please?", a: ["a", "an", "the", "-"], correct: 2 },
        { q: "He wants to be ___ doctor.", a: ["a", "an", "the", "-"], correct: 0 },
        { q: "___ sun is very hot today.", a: ["A", "An", "The", "-"], correct: 2 },
        { q: "I have ___ idea!", a: ["a", "an", "the", "-"], correct: 1 },
        { q: "We went to ___ Paris last summer.", a: ["a", "an", "the", "-"], correct: 3 },
        { q: "Do you like ___ coffee?", a: ["a", "an", "the", "-"], correct: 3 }, 
        { q: "This is ___ best movie ever!", a: ["a", "an", "the", "-"], correct: 2 },
        { q: "He plays ___ guitar very well.", a: ["a", "an", "the", "-"], correct: 2 },
        { q: "I need ___ umbrella because it's raining.", a: ["a", "an", "the", "-"], correct: 1 },
        { q: "___ Earth goes around ___ sun.", a: ["The / the", "A / a", "- / the", "The / -"], correct: 0 },
        { q: "She has ___ cat and ___ dog.", a: ["a / a", "an / an", "the / the", "- / -"], correct: 0 },
        { q: "Look at ___ moon!", a: ["a", "an", "the", "-"], correct: 2 },
        { q: "I live in ___ United States.", a: ["a", "an", "the", "-"], correct: 2 },
        { q: "He is ___ university student.", a: ["a", "an", "the", "-"], correct: 0 },
        { q: "Would you like ___ apple?", a: ["a", "an", "the", "-"], correct: 1 },
        { q: "___ water is essential for life.", a: ["A", "An", "The", "-"], correct: 3 },
        { q: "Who is ___ man in the photo?", a: ["a", "an", "the", "-"], correct: 2 },
        { q: "It was ___ honor to meet you.", a: ["a", "an", "the", "-"], correct: 1 },
        { q: "I go to school by ___ bus.", a: ["a", "an", "the", "-"], correct: 3 },
        { q: "___ rich should help ___ poor.", a: ["The / the", "A / a", "- / -", "An / an"], correct: 0 },
        { q: "She works as ___ engineer.", a: ["a", "an", "the", "-"], correct: 0 },
        { q: "I didn't have ___ breakfast.", a: ["a", "an", "the", "-"], correct: 3 },
        { q: "___ Nile is the longest river.", a: ["A", "An", "The", "-"], correct: 2 },
        { q: "Is there ___ bank near here?", a: ["a", "an", "the", "-"], correct: 0 },
        { q: "I love ___ music.", a: ["a", "an", "the", "-"], correct: 3 },
        { q: "He is ___ only child.", a: ["a", "an", "the", "-"], correct: 2 },
        { q: "___ hour has 60 minutes.", a: ["A", "An", "The", "-"], correct: 1 },
        { q: "Open ___ window, please.", a: ["a", "an", "the", "-"], correct: 2 }
    ];

    const arena = createMatrix(12, 20);

    const player = {
        pos: {x: 0, y: 0},
        matrix: null,
        score: 0,
    };

    function createMatrix(w, h) {
        const matrix = [];
        while (h--) {
            matrix.push(new Array(w).fill(0));
        }
        return matrix;
    }

    function createPiece(type) {
        if (type === 'I') {
            return [
                [0, 1, 0, 0],
                [0, 1, 0, 0],
                [0, 1, 0, 0],
                [0, 1, 0, 0],
            ];
        } else if (type === 'L') {
            return [
                [0, 2, 0],
                [0, 2, 0],
                [0, 2, 2],
            ];
        } else if (type === 'J') {
            return [
                [0, 3, 0],
                [0, 3, 0],
                [3, 3, 0],
            ];
        } else if (type === 'O') {
            return [
                [4, 4],
                [4, 4],
            ];
        } else if (type === 'Z') {
            return [
                [5, 5, 0],
                [0, 5, 5],
                [0, 0, 0],
            ];
        } else if (type === 'S') {
            return [
                [0, 6, 6],
                [6, 6, 0],
                [0, 0, 0],
            ];
        } else if (type === 'T') {
            return [
                [0, 7, 0],
                [7, 7, 7],
                [0, 0, 0],
            ];
        }
    }

    function drawMatrix(matrix, offset) {
        matrix.forEach((row, y) => {
            row.forEach((value, x) => {
                if (value !== 0) {
                    // Gradient effect
                    const gradient = context.createLinearGradient(x, y, x + 1, y + 1);
                    gradient.addColorStop(0, colors[value]);
                    gradient.addColorStop(0.5, adjustColor(colors[value], 40)); 
                    gradient.addColorStop(1, adjustColor(colors[value], -40)); 
                    
                    context.fillStyle = gradient;
                    context.fillRect(x + offset.x, y + offset.y, 1, 1);
                    
                    // Bevel border
                    context.lineWidth = 0.05;
                    context.strokeStyle = 'rgba(255,255,255,0.5)';
                    context.strokeRect(x + offset.x, y + offset.y, 1, 1);
                }
            });
        });
    }

    function adjustColor(color, amount) {
        return '#' + color.replace(/^#/, '').replace(/../g, color => ('0'+Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));
    }

    function draw() {
        context.fillStyle = '#000';
        context.fillRect(0, 0, canvas.width, canvas.height);
        drawMatrix(arena, {x: 0, y: 0});
        drawMatrix(player.matrix, player.pos);
    }

    function merge(arena, player) {
        player.matrix.forEach((row, y) => {
            row.forEach((value, x) => {
                if (value !== 0) {
                    arena[y + player.pos.y][x + player.pos.x] = value;
                }
            });
        });
    }

    function rotate(matrix, dir) {
        for (let y = 0; y < matrix.length; ++y) {
            for (let x = 0; x < y; ++x) {
                [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
            }
        }
        if (dir > 0) {
            matrix.forEach(row => row.reverse());
        } else {
            matrix.reverse();
        }
    }

    function playerDrop() {
        player.pos.y++;
        if (collide(arena, player)) {
            player.pos.y--;
            merge(arena, player);
            playerReset();
            arenaSweep();
            updateScore();
        }
        dropCounter = 0;
    }

    function playerMove(offset) {
        player.pos.x += offset;
        if (collide(arena, player)) {
            player.pos.x -= offset;
        }
    }

    function playerReset() {
        const pieces = 'ILJOTSZ';
        player.matrix = createPiece(pieces[pieces.length * Math.random() | 0]);
        player.pos.y = 0;
        player.pos.x = (arena[0].length / 2 | 0) - (player.matrix[0].length / 2 | 0);
        
        if (collide(arena, player)) {
            endGame(false);
        }
    }

    function playerRotate(dir) {
        const pos = player.pos.x;
        let offset = 1;
        rotate(player.matrix, dir);
        while (collide(arena, player)) {
            player.pos.x += offset;
            offset = -(offset + (offset > 0 ? 1 : -1));
            if (offset > player.matrix[0].length) {
                rotate(player.matrix, -dir);
                player.pos.x = pos;
                return;
            }
        }
    }

    function collide(arena, player) {
        const m = player.matrix;
        const o = player.pos;
        for (let y = 0; y < m.length; ++y) {
            for (let x = 0; x < m[y].length; ++x) {
                if (m[y][x] !== 0 &&
                   (arena[y + o.y] && arena[y + o.y][x + o.x]) !== 0) {
                    return true;
                }
            }
        }
        return false;
    }

    function arenaSweep() {
        let rowCount = 0;
        outer: for (let y = arena.length -1; y > 0; --y) {
            for (let x = 0; x < arena[y].length; ++x) {
                if (arena[y][x] === 0) {
                    continue outer;
                }
            }
            const row = arena.splice(y, 1)[0].fill(0);
            arena.unshift(row);
            ++y;
            rowCount++;
        }
        
        if (rowCount > 0) {
            score += rowCount * 10;
            triggerQuestion();
        }
    }

    function updateScore() {
        document.getElementById('score').innerText = score;
    }

    function updateStars() {
        document.getElementById('stars-count').innerText = stars + " / 20";
        let starStr = "";
        for(let i=0; i<20; i++) {
            starStr += (i < stars) ? "‚≠ê" : "‚òÜ";
        }
        document.getElementById('stars-display').innerText = starStr.substring(0, 5) + (stars > 5 ? "..." : ""); 
    }

    function getRandomQuestion() {
        const available = questions.filter((_, index) => !usedQuestions.has(index));
        
        if (available.length === 0) {
            usedQuestions.clear();
            return questions[Math.floor(Math.random() * questions.length)];
        }

        const randomIndex = Math.floor(Math.random() * available.length);
        const originalIndex = questions.indexOf(available[randomIndex]);
        usedQuestions.add(originalIndex);
        
        return available[randomIndex];
    }

    function triggerQuestion() {
        isPaused = true;
        const qData = getRandomQuestion();
        
        questionText.innerText = qData.q;
        optionsContainer.innerHTML = '';
        feedback.innerText = '';

        qData.a.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt === "-" ? "(no article)" : opt;
            btn.onclick = () => checkAnswer(index, qData.correct);
            optionsContainer.appendChild(btn);
        });

        modal.style.display = 'flex';
    }

    function checkAnswer(selectedIndex, correctIndex) {
        const buttons = optionsContainer.getElementsByTagName('button');
        
        if (selectedIndex === correctIndex) {
            feedback.innerText = "Correct! +1 Star";
            feedback.className = "feedback correct";
            stars++;
            updateStars();
            
            for(let btn of buttons) btn.disabled = true;

            if (stars >= 20) {
                setTimeout(() => {
                    modal.style.display = 'none';
                    endGame(true);
                }, 1000);
            } else {
                setTimeout(() => {
                    modal.style.display = 'none';
                    isPaused = false;
                    update(); 
                }, 1000);
            }
        } else {
            feedback.innerText = "Wrong! Try again.";
            feedback.className = "feedback wrong";
        }
    }

    function endGame(win) {
        isGameOver = true;
        document.getElementById('game-over-screen').style.display = 'flex';
        const title = document.getElementById('end-title');
        const scoreTxt = document.getElementById('end-score');
        
        if (win) {
            title.innerText = "YOU WIN!";
            title.style.color = "#00ff00";
        } else {
            title.innerText = "GAME OVER";
            title.style.color = "#ff0000";
        }
        scoreTxt.innerText = `Total Stars: ${stars} / 20`;
    }

    function startGame(level) {
        document.getElementById('start-screen').style.display = 'none';
        currentLevel = level;
        
        if (level === 'easy') {
            dropInterval = 1000;
            document.getElementById('level-display').innerText = "Easy";
        } else if (level === 'medium') {
            dropInterval = 500;
            document.getElementById('level-display').innerText = "Medium";
        } else {
            dropInterval = 200;
            document.getElementById('level-display').innerText = "Hard";
        }

        playerReset();
        updateScore();
        updateStars();
        update();
    }

    function update(time = 0) {
        if (isPaused || isGameOver) return;

        const deltaTime = time - lastTime;
        lastTime = time;

        dropCounter += deltaTime;
        if (dropCounter > dropInterval) {
            playerDrop();
        }

        draw();
        requestAnimationFrame(update);
    }

    // Keyboard Controls
    document.addEventListener('keydown', event => {
        if (isPaused || isGameOver) return;

        if (event.keyCode === 37) { 
            playerMove(-1);
        } else if (event.keyCode === 39) { 
            playerMove(1);
        } else if (event.keyCode === 40) { 
            playerDrop();
        } else if (event.keyCode === 38) { 
            playerRotate(1);
        }
    });

</script>
</body>
</html>